# 티켓 판매 애플리케이션 구현하기
## 상황
- 추첨을 통해 선정된 관람객에게 공연을 무료로 관람할 수 있는 초대장을 발송한다.

## 염두해둬야 할 점
- 이벤트에 당첨된 관람객과 그렇지 못한 관람객은 다른 방식으로 입장시켜야 한다.
  - 이벤트에 당첨된 관람객 - 초대장을 티켓으로 교환한 후에 입장할 수 있다.
  - 이벤트에 당첨되지 않은 관람객 - 티켓을 구매해야만 입장할 수 있다.

- 즉, 관람객을 입장시키기 전에 이벤트 당첨 여부를 확인해야 하고, 이벤트 당첨자가 아닌 경우에는 티켓을 판매한 후에 입장시켜야 한다.

## 구현
- 애플리케이션 핵심 클래스  
  ![classDiagram](https://user-images.githubusercontent.com/51159167/155103641-21139463-8591-41e9-acef-48607cb49eb9.png)

## 무엇이 문제인가?

로버트 마틴에 따르면 모든 모듈은 제대로 실행되야 하고, 변경이 용이해야 하며, 이해하기 쉬워야 한다.  
앞에서 작성한 프로그램은 관람객들을 입장시키는 데 필요한 기능을 오류 없이 정확하게 수행하고 있다. 따라서 제대로 동작해야 한다는 제약은 만족시킨다.   
하지만 불행하게도 변경 용이성과 읽는 사람과의 의사소통이라는 목적은 만족시키지 못한다.

**예상을 빗나가는 코드**
- Theater 클래스의 문제는 관람객과 판매원의 소극장의 통제를 받는 수동적인 존재라는 점이다.
  - 관람객의 입장에서 문제는 소극장이라는 제 3자가 초대장을 확인하기 위해 관람객의 가방을 마음대로 열어본다는 데 있다.
  - 판매원의 입장에서 문제는 소극장이 허락도 없이 매표소에 보관중인 티켓과 현금에 마음대로 접근한다는 데 있다.
- 코드를 이해하기 어렵게 만드는 이유는 
  1. 우리의 상식과 너무나도 다르게 동작하기 때문에 코드를 읽는 사람과 제대로 의사소통 하지 못한다.
  2. 이 코드를 이해하기 위해서는 여러 가지 세부적인 내용들을 한꺼번에 기억하고 있어야 한다는 점이다.  
     하나의 클래스나 메소드에서 너무 많은 세부사항을 다루기 때문에 코드를 작성하는 사람 뿐만 아니라 코드를 읽고 이해해야 하는 사람 모두에게 큰 부담을 준다.
  
**변경에 취약한 코드**
- 가장 심각한 문제는 변경에 취약하다는 점이다. Audience와 TicketSeller를 변경할 경우 Theater도 함께 변경해야 한다.
- 너무 많은 클래스에 의존하는 Theater   
  ![ClassDiagram(Theater)](https://user-images.githubusercontent.com/51159167/155100025-08849e37-b963-46c5-b579-93ac5f7f2fec.png)


## 설계 개선하기
- 코드를 이해하기 어려운 이유는 의도를 정확하게 의사 소통하지 못하기 때문이다.  
  (관람객과 판매원이 자신의 일을 스스로 처리하지 않고 Theater가 관람객의 가방과 판매원의 매표소에 직접 접근하여 처리하여 우리의 예상을 벗어남)
- Audience와 TicketSeller를 변경할 때 Theater도 함께 변경해야 하기 때문에 전체적으로 코드를 변경하기도 어려워진다.
- 해결 방법은 Theater가 Audience와 TicketSeller에 관해 너무 세세한 부분까지 알지 못하도록 정보를 차단하면 된다.
- 즉, 관람객과 판매원을 **자율적인 존재**로 만들면 되는 것이다.
- Theater의 결합도를 낮춘 설계   
  ![ClassDiagram(Theater) -  Lower the Coupling](https://user-images.githubusercontent.com/51159167/155099784-bd888152-f285-4aa6-a6e3-54ec0da2e25a.png)


- 자율적인 Audience와 TicketSeller로 구성된 설계   
  ![classDiagram(improvement)](https://user-images.githubusercontent.com/51159167/155101800-638f9b24-faf2-45a3-a2e7-081071f56749.png)

## 무엇이 개선됐는가
- 초기 코드와 마찬가지로 관람객들을 입장시키는 데 필요한 기능을 오류없이 수행한다. (동작 수행)
- 수정된 Audience와 TicketSeller는 자신이 가지고 있는 소지품을 스스로 관리한다. (코드를 읽는 사람과의 의사소통)
- Audience와 TicketSeller의 내부 구현을 변경하더라도 Theater를 함께 변경할 필요가 없어졌다. (변경 용이성)

## 어떻게 한 것인가?
- 판매자가 티켓을 판매하기 위해 TicketOffice를 사용하는 모든 부분을 TicketSeller 내부로 옮기고, 관람객이 티켓을 구매하기 위해 Bag을 사용하는 모든 부분은 Audience 내부로 옮겼다.
- 즉, 자기 자신의 문제를 스스로 해결하도록 코드를 변경한 것이다.
- 객체의 자율성을 높이는 방향으로 설계를 개선했다. 그 결과, 이해하기 쉽고 유연한 설계를 얻을 수 있었다.
